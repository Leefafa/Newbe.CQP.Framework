# 如何进行调试

本示例采用[鹦鹉学舌](http://git.oschina.net/yks/Newbe.CQP.Framework/tree/dev/Newbe.CQP.Plugins.Parrot?dir=1&filepath=Newbe.CQP.Plugins.Parrot&oid=4df83c567e07af45506b456214d81ecebe82d9ba&sha=1b2e6f87c159da257183c1f4dc2c184694a19933)这个插件来进行演示，如何对使用本框架开发的添加进行调试。

本示例采用的是VS2017作为演示IDE。

## 使用debug模式生成dll

克隆示例代码，打开解决方案，并使用Debug解决方案配置进行编译

![Debug编译](assets/499/002-94703000.png)

## 将dll和pdb复制到对应的文件夹

- 将`Newbe.CQP.Framework/ForMain`文件夹下的文件复制到`CQP.exe`同级文件夹下
- 将`Newbe.CQP.Framework/ForPlugin`文件夹下的文件复制到`app`文件夹下
- 将`bin/Debug`文件夹下的文件复制到`CQP.exe`同级文件夹的`Newbe.CQP.Plugins.Parrot`文件夹下

复制结束后结果如下：

```bash
│  Autofac.dll
│  CQA.exe
│  Newbe.CQP.Framework.dll
│  Newbe.CQP.Framework.PluginLoader.dll
│
├─app
│      Newbe.CQP.Plugins.Parrot.dll
│      Newbe.CQP.Plugins.Parrot.json
│
├─bin
│      CQP.dll
│      gzip.dll
│      htmlayout.dll
│      libeay32.dll
│      libiconv.dll
│      sqlite3.dll
│      zlib1.dll
│
├─conf
│      Account.cfg
│      CQA.key
│      CQP.cfg
│
└─Newbe.CQP.Plugins.Parrot
        Autofac.dll
        Newbe.CQP.Framework.dll
        Newbe.CQP.Plugins.Parrot.dll
        Newbe.CQP.Plugins.Parrot.pdb     # 特别要注意这里有pdb文件，别忘了
```

## 通过vs菜单附加进程

启动酷Q，通过VS菜单`调试`->`附加到进程`打开对话框。

查找到酷Q对应的进程，选中。**注意！此时附加到的类型默认下是托管v4.0，这样直接点击"附加"是不行的！是不行的！是不行的！**

![默认附加进程](assets/499/002-73a953e9.png)

点击右侧选择按钮，弹出"选择代码类型"对话框，选中托管v4.0和本机两个选项，并点击确定。

![选择代码类型](assets/499/002-79ae40eb.png)

至此，点击右下角的附加按钮，则VS就进入到了附加进程模式。

下断点，发消息，命中！

![命中断点](assets/499/002-3701a2a2.png)

## 其他注意点

### 附加进程结束会导致酷Q进程退出

附加进程结束会导致酷Q进程退出，这是正常现象！

### 如何调试构造函数

你居然要调试构造函数，先想想是不是这个事情不用在构造函数里面做。

如果一定要调试，可按照以下步骤进行操作：

首先，按照上述说明中的内容，将dll和pdb复制完毕。

其次，设置需要调试的项目为启动项目。

![启动项目](assets/499/002-1d282813.png)

然后，在项目属性页中的调试选项卡设置为"启动外部程序"。

![调试设置](assets/499/002-2755940f.png)

最后，在构造函数下好断点，F5启动调试。

注意，调试过程中会出现以下对话框，原因是调试导致插件加载超时而报错。如果想要调试完毕，那么**不要点击确认，点击确认会导致进程结束**！

![构造函数中报错](assets/499/002-0bd30fde.png)
